// Generated by CoffeeScript 1.8.0

/*
	Submitting the email to parse
	
	Dependancies:
		Parse Javascript API
		JQuery
	ID's
		'previewEmailSubscribe'
	Notes
		This must be compiled to .js (alt+shift+c)
 */
var PARSE_APP_ID, PARSE_JAVASCRIPT_KEY, parseInitialized, submitEmail;

PARSE_APP_ID = 'jeoeVa2Nz3VLmrnWpAknbWKZADXHbmQltPSlU8mX';

PARSE_JAVASCRIPT_KEY = 'JoQ24unwktkQMuMvfOjH5KmZCfGswRDPbEiKa7Vz';

parseInitialized = false;

submitEmail = function(email) {
  var PreviewSubscription, prevSub;
  console.log('Submitting...');
  if (!parseInitialized) {
    Parse.initialize(PARSE_APP_ID, PARSE_JAVASCRIPT_KEY);
    parseInitialized = true;
  }
  PreviewSubscription = Parse.Object.extend('PreviewSubscription');
  prevSub = new PreviewSubscription();
  prevSub.set('email', email);
  return prevSub.save(null, {
    success: function(gameScore) {
      alert("Saved Email \'" + email + "\'");
      return console.log('Save Successful');
    },
    failure: function(gameScore, error) {
      alert("Oops! There was an error submitting your email. Refresh the page and try again.");
      return console.log('Save Failed. Error: ' + error);
    }
  });
};

$('#previewEmailSubscribe').submit(function(event) {
  var $email, isValidEmailInput;
  $email = $('#previewEmailSubscribe input[name=email]').val();
  if ($email.indexOf('@') > -1) {
    isValidEmailInput = true;
    submitEmail($email);
  } else {
    alert('Please enter a valid email.');
  }
  return event.preventDefault();
});
